<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Katalog Kue Lebaran Premium</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        rose: {
                            50: '#fff1f2',
                            100: '#ffe4e6',
                            200: '#fecdd3',
                            300: '#fda4af',
                            400: '#fb7185',
                            500: '#f43f5e',
                            600: '#e11d48',
                        }
                    },
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                        script: ['Dancing Script', 'cursive'],
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Poppins:wght@300;400;500;600&family=Dancing+Script:wght@600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #FFF5F5;
            color: #4A4A4A;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Smooth Scroll */
        html { scroll-behavior: smooth; }

        .pattern-bg {
            background-image: 
                radial-gradient(#FECDD3 1px, transparent 1px),
                radial-gradient(#FECDD3 1px, transparent 1px);
            background-size: 40px 40px;
            background-position: 0 0, 20px 20px;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        /* Modal Transitions */
        .modal {
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            transform: scale(0.95) translateY(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .modal.active .modal-content {
            transform: scale(1) translateY(0);
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Toast Animation */
        #toast {
            visibility: hidden;
            min-width: 250px;
            background: rgba(255, 255, 255, 0.95);
            color: #be185d;
            text-align: center;
            border-radius: 50px;
            padding: 16px 24px;
            position: fixed;
            z-index: 100;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%) translateY(20px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 30px -5px rgba(255, 182, 193, 0.5);
            font-weight: 600;
            border: 1px solid #FCE7F3;
        }
        #toast.show {
            visibility: visible;
            opacity: 1;
            transform: translateX(-50%) translateY(0);
            bottom: 40px;
        }

        /* Loading Spinner */
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #f43f5e;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Debug Console (Hidden by default) */
        #debug-console {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.85);
            color: #00ff00;
            font-family: monospace;
            padding: 10px;
            font-size: 10px;
            z-index: 9999;
            max-height: 150px;
            overflow-y: auto;
        }
    </style>
</head>
<body class="pattern-bg antialiased selection:bg-rose-200 selection:text-rose-900">

    <!-- Debug Console Output -->
    <div id="debug-console"><strong>System Logs:</strong><br></div>

    <!-- Admin Notification Bar -->
    <div id="admin-bar" class="hidden fixed top-0 left-0 right-0 z-50 bg-gray-900 text-white text-center py-2 text-xs font-medium shadow-md transition-all">
        <div class="flex justify-center items-center gap-3">
            <span class="flex items-center gap-2"><i class="fas fa-shield-alt text-rose-400"></i> Mode Admin Aktif</span>
            <button onclick="logoutAdmin()" class="bg-gray-700 px-3 py-0.5 rounded-full hover:bg-gray-600 transition text-[10px] uppercase tracking-wider">Keluar</button>
        </div>
    </div>

    <!-- Navbar -->
    <nav class="fixed w-full z-40 top-0 transition-all duration-300 mt-0" id="main-nav">
        <div class="absolute inset-0 bg-white/80 backdrop-blur-md shadow-sm border-b border-white/50"></div>
        <div class="max-w-6xl mx-auto px-4 relative">
            <div class="flex justify-between items-center h-20">
                <!-- Logo -->
                <div class="flex items-center gap-3 group cursor-pointer" onclick="window.scrollTo(0,0)">
                    <div class="bg-gradient-to-tr from-rose-400 to-pink-300 p-2.5 rounded-2xl shadow-lg shadow-rose-200 group-hover:shadow-rose-300 transition-all duration-300 transform group-hover:rotate-12">
                        <i class="fas fa-cookie-bite text-white text-xl"></i>
                    </div>
                    <div class="flex flex-col">
                        <span class="font-bold text-2xl text-gray-800 font-serif leading-none tracking-tight">Dapur <span class="text-rose-500">Raline</span></span>
                        <span class="text-[10px] text-gray-500 font-medium tracking-widest uppercase mt-1">Balikpapan</span>
                    </div>
                </div>
                
                <!-- Right Actions -->
                <div class="flex items-center gap-3">
                    <button id="nav-add-btn" onclick="openModal()" class="hidden bg-white text-rose-500 border border-rose-100 hover:bg-rose-50 px-4 py-2 rounded-full text-xs font-bold transition shadow-sm items-center gap-2">
                        <i class="fas fa-plus"></i> <span class="hidden sm:inline">Produk</span>
                    </button>

                    <button id="admin-toggle-btn" onclick="toggleAdminModal()" class="w-10 h-10 rounded-full flex items-center justify-center text-gray-400 hover:text-rose-500 hover:bg-rose-50 transition active:scale-95" title="Login Admin">
                        <i class="fas fa-lock text-sm"></i>
                    </button>
                    
                    <a href="#menu" class="bg-gradient-to-r from-emerald-500 to-teal-500 text-white px-5 py-2.5 rounded-full text-sm font-semibold shadow-lg shadow-emerald-100 hover:shadow-emerald-200 hover:-translate-y-0.5 active:translate-y-0 transition-all duration-300 flex items-center gap-2">
                        <i class="fab fa-whatsapp text-lg"></i> 
                        <span class="hidden xs:inline">Order</span>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="pt-32 pb-12 px-6 text-center relative overflow-hidden">
        <div class="absolute top-20 left-10 text-rose-200 opacity-50 animate-bounce delay-700"><i class="fas fa-star text-xl"></i></div>
        <div class="absolute top-40 right-20 text-orange-200 opacity-50 animate-bounce delay-1000"><i class="fas fa-heart text-2xl"></i></div>

        <div class="max-w-2xl mx-auto relative z-10">
            <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-white border border-rose-100 shadow-sm mb-6 animate-fade-in-up">
                <span class="w-2 h-2 rounded-full bg-rose-500 animate-pulse"></span>
                <span class="text-xs font-bold text-rose-500 tracking-wide uppercase">Open PO Batch 1</span>
            </div>
            
            <h1 class="text-4xl md:text-6xl font-bold text-gray-800 mb-4 leading-tight font-serif">
                Sajikan <span class="font-script text-5xl md:text-7xl text-rose-500 block sm:inline mt-2 sm:mt-0">Cinta</span> <br class="hidden sm:block"/>
                di Hari Raya
            </h1>
            
            <p class="text-gray-500 text-base md:text-lg mb-8 leading-relaxed max-w-lg mx-auto font-light">
                Kue kering premium homemade dengan bahan berkualitas, tanpa pengawet, dibuat sepenuh hati untuk momen spesial.
            </p>
            
            <div class="flex justify-center gap-4">
                <a href="#menu" class="group bg-rose-500 text-white px-8 py-3.5 rounded-full font-semibold shadow-xl shadow-rose-200 hover:shadow-rose-300 hover:bg-rose-600 transition-all duration-300 transform hover:-translate-y-1">
                    <span>Lihat Menu</span>
                    <i class="fas fa-arrow-down ml-2 group-hover:translate-y-1 transition-transform"></i>
                </a>
            </div>
        </div>
    </header>

    <!-- Menu Section -->
    <section id="menu" class="py-10 px-4 max-w-6xl mx-auto min-h-[600px] relative">
        <div class="flex flex-col items-center mb-10">
            <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2 font-serif">Menu Favorit Bunda</h2>
            <div class="h-1 w-24 bg-gradient-to-r from-transparent via-rose-300 to-transparent rounded-full"></div>
            <p class="text-gray-400 text-sm mt-3 italic mb-4">"Dibuat fresh by order"</p>
        </div>

        <!-- Floating Add Button (Admin Only) -->
        <button id="fab-add-btn" onclick="openModal()" class="hidden fixed bottom-8 right-6 z-30 bg-gray-900 hover:bg-black text-white w-14 h-14 rounded-full shadow-2xl flex items-center justify-center transition transform hover:scale-110 group">
            <i class="fas fa-plus text-xl group-hover:rotate-90 transition-transform duration-300"></i>
        </button>

        <!-- Loading State -->
        <div id="loading" class="text-center py-20 bg-white/50 backdrop-blur-sm rounded-3xl mx-auto max-w-sm">
            <i class="fas fa-spinner fa-spin text-3xl text-rose-400 mb-4"></i>
            <p class="text-gray-500 font-medium">Sedang menyiapkan etalase kue...</p>
            <p id="config-error" class="text-red-500 text-xs mt-4 hidden px-4">Error: Konfigurasi Firebase Belum Diatur (Lihat kode)</p>
        </div>

        <!-- Menu Grid Container -->
        <div id="menu-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 pb-24">
            <!-- Items injected by JS -->
        </div>
    </section>

    <!-- Features Section -->
    <section class="py-16 px-6 bg-white border-t border-rose-50 relative overflow-hidden">
        <!-- Decoration -->
        <div class="absolute top-0 left-0 w-20 h-20 bg-rose-50 rounded-br-full opacity-50"></div>
        <div class="absolute bottom-0 right-0 w-20 h-20 bg-orange-50 rounded-tl-full opacity-50"></div>

        <div class="max-w-6xl mx-auto relative z-10">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Feature 1 -->
                <div class="bg-rose-50/50 p-8 rounded-3xl text-center border border-rose-100 hover:bg-rose-50 transition-colors group cursor-default">
                    <div class="w-16 h-16 bg-white rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-sm text-rose-400 text-2xl group-hover:scale-110 transition-transform duration-300">
                        <i class="fas fa-crown"></i>
                    </div>
                    <h4 class="text-lg font-bold text-gray-800 mb-2 font-serif">Bahan Premium</h4>
                    <p class="text-gray-500 text-sm leading-relaxed">Menggunakan butter wisman dan bahan-bahan pilihan tanpa pengawet untuk rasa otentik.</p>
                </div>
                
                <!-- Feature 2 -->
                <div class="bg-orange-50/50 p-8 rounded-3xl text-center border border-orange-100 hover:bg-orange-50 transition-colors group cursor-default">
                    <div class="w-16 h-16 bg-white rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-sm text-orange-400 text-2xl group-hover:scale-110 transition-transform duration-300">
                        <i class="fas fa-heart"></i>
                    </div>
                    <h4 class="text-lg font-bold text-gray-800 mb-2 font-serif">Made with Love</h4>
                    <p class="text-gray-500 text-sm leading-relaxed">Dibuat secara homemade dengan penuh cinta, higienis, dan dikemas rapi dalam toples tebal.</p>
                </div>

                <!-- Feature 3 -->
                <div class="bg-emerald-50/50 p-8 rounded-3xl text-center border border-emerald-100 hover:bg-emerald-50 transition-colors group cursor-default">
                    <div class="w-16 h-16 bg-white rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-sm text-emerald-400 text-2xl group-hover:scale-110 transition-transform duration-300">
                        <i class="fas fa-shipping-fast"></i>
                    </div>
                    <h4 class="text-lg font-bold text-gray-800 mb-2 font-serif">Pengiriman Aman</h4>
                    <p class="text-gray-500 text-sm leading-relaxed">Garansi kue sampai dengan selamat. Siap kirim ke seluruh area dengan kurir terpercaya.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-[#FFF0F5] pt-20 pb-10 px-6 relative overflow-hidden">
        <div class="absolute -top-24 -left-24 w-64 h-64 bg-rose-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30"></div>
        <div class="absolute -bottom-24 -right-24 w-64 h-64 bg-orange-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30"></div>

        <div class="max-w-4xl mx-auto text-center relative z-10">
            <span class="font-script text-3xl text-rose-500 mb-2 block">Jangan Sampai Kehabisan</span>
            <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-6 font-serif">Siap Memesan, Bund?</h2>
            
            <div class="bg-white p-2 rounded-2xl shadow-xl shadow-rose-100 max-w-sm mx-auto transform hover:scale-105 transition duration-300">
                <a href="#" onclick="contactWA()" class="block bg-gradient-to-r from-emerald-500 to-teal-500 text-white py-4 rounded-xl font-bold text-lg shadow-md hover:shadow-lg transition flex items-center justify-center gap-3">
                    <i class="fab fa-whatsapp text-2xl"></i> Chat Admin (WA)
                </a>
            </div>

            <!-- Social & Github Connection -->
            <div class="flex justify-center items-center gap-4 mt-8">
                <a href="https://instagram.com" target="_blank" class="w-10 h-10 rounded-full bg-white shadow-sm flex items-center justify-center text-rose-500 hover:bg-gradient-to-tr hover:from-purple-500 hover:to-orange-500 hover:text-white hover:scale-110 transition duration-300">
                    <i class="fab fa-instagram text-lg"></i>
                </a>
                <a href="https://github.com" target="_blank" class="w-10 h-10 rounded-full bg-white shadow-sm flex items-center justify-center text-gray-700 hover:bg-gray-800 hover:text-white hover:scale-110 transition duration-300" title="Visit our GitHub">
                    <i class="fab fa-github text-lg"></i>
                </a>
            </div>
            
            <p class="text-gray-400 text-xs mt-6 font-medium tracking-wide">
                &copy; 2026 DAPUR KUE LEBARAN ‚Ä¢ MADE WITH LOVE ‚ù§Ô∏è
            </p>
        </div>
    </footer>

    <!-- ================= MODALS ================= -->

    <!-- 1. LOGIN ADMIN MODAL -->
    <div id="login-modal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-gray-900/40 backdrop-blur-sm px-4">
        <div class="modal-content bg-white rounded-3xl shadow-2xl w-full max-w-xs overflow-hidden p-8 relative">
             <button onclick="closeLoginModal()" class="absolute top-4 right-4 w-8 h-8 flex items-center justify-center rounded-full bg-gray-50 text-gray-400 hover:bg-gray-100 transition"><i class="fas fa-times"></i></button>
            
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-rose-50 rounded-2xl flex items-center justify-center mx-auto mb-4 text-rose-500 text-2xl rotate-3">
                    <i class="fas fa-magic"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-800 font-serif">Dapur Admin</h3>
                <p class="text-gray-400 text-xs mt-1">Area khusus pemilik dapur</p>
            </div>
            
            <form onsubmit="handleLogin(event)">
                <input type="password" id="admin-password" placeholder="Masukkan Password" class="w-full bg-gray-50 border border-gray-100 rounded-xl px-4 py-3.5 mb-4 focus:ring-2 focus:ring-rose-200 focus:border-rose-300 outline-none text-center text-gray-600 placeholder-gray-400 transition" style="font-size: 16px;">
                <button type="submit" class="w-full py-3.5 bg-gray-800 text-white rounded-xl font-bold hover:bg-gray-700 active:scale-95 transition shadow-lg">Buka Dapur</button>
                <button type="button" onclick="resetData()" class="w-full mt-2 py-2 text-rose-500 text-xs font-bold hover:bg-rose-50 rounded-lg transition">Reset Data (Darurat)</button>
            </form>
        </div>
    </div>

    <!-- 2. ADD/EDIT MENU MODAL -->
    <div id="item-modal" class="modal fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-gray-900/40 backdrop-blur-sm sm:px-4">
        <div class="modal-content bg-white rounded-t-3xl sm:rounded-3xl shadow-2xl w-full max-w-md overflow-hidden flex flex-col max-h-[90vh] sm:max-h-[85vh] transition-transform">
            
            <!-- Header -->
            <div class="bg-white px-6 py-5 flex justify-between items-center flex-shrink-0 sticky top-0 z-20 border-b border-gray-50">
                <div>
                    <h3 id="modal-title" class="text-gray-800 font-bold text-xl font-serif">Menu Baru</h3>
                    <p class="text-xs text-gray-400">Isi detail kue dengan lengkap ya</p>
                </div>
                <button onclick="closeModal()" class="bg-gray-50 text-gray-400 hover:bg-rose-50 hover:text-rose-500 w-10 h-10 rounded-full flex items-center justify-center transition"><i class="fas fa-times"></i></button>
            </div>
            
            <form id="menu-form" onsubmit="handleFormSubmit(event)" class="p-6 space-y-6 overflow-y-auto flex-grow no-scrollbar bg-white">
                <input type="hidden" id="item-id">
                
                <!-- Nama Produk -->
                <div class="space-y-2">
                    <label class="text-xs font-bold text-gray-400 uppercase tracking-wider ml-1">Nama Kue</label>
                    <input type="text" id="item-name" placeholder="Misal: Nastar Keju Lumer" required class="w-full bg-gray-50 border border-gray-100 rounded-2xl px-5 py-3.5 focus:ring-2 focus:ring-rose-200 focus:bg-white outline-none transition text-gray-700 font-medium">
                </div>

                <!-- Upload Foto -->
                <div class="space-y-2">
                    <label class="text-xs font-bold text-gray-400 uppercase tracking-wider ml-1">Foto Cantik</label>
                    
                    <!-- Preview Image -->
                    <div id="image-preview-container" class="mb-3 hidden relative group">
                         <img id="image-preview" src="" class="w-full h-48 object-cover rounded-2xl shadow-sm">
                         <div class="absolute inset-0 bg-black/40 rounded-2xl hidden group-hover:flex items-center justify-center text-white text-sm font-medium backdrop-blur-sm transition cursor-pointer" onclick="document.getElementById('item-file').click()">Ganti Foto</div>
                    </div>

                    <!-- Tabs -->
                    <div class="flex p-1 bg-gray-50 rounded-xl mb-3">
                        <button type="button" onclick="toggleUploadMode('file')" id="tab-file" class="flex-1 py-2 rounded-lg text-sm font-semibold text-rose-500 bg-white shadow-sm transition-all">Upload</button>
                        <button type="button" onclick="toggleUploadMode('url')" id="tab-url" class="flex-1 py-2 rounded-lg text-sm font-medium text-gray-400 hover:text-gray-600 transition-all">Link URL</button>
                    </div>

                    <!-- File Input -->
                    <div id="input-file-group" class="border-2 border-dashed border-gray-200 rounded-2xl p-6 text-center hover:bg-rose-50/50 hover:border-rose-200 transition relative group">
                        <input type="file" id="item-file" accept="image/*" onchange="handleFileSelect(this)" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10">
                        <div class="text-gray-400 group-hover:text-rose-400 transition">
                            <i class="fas fa-cloud-upload-alt text-3xl mb-2"></i>
                            <p class="text-xs font-medium">Ketuk untuk pilih foto dari galeri</p>
                        </div>
                    </div>

                    <!-- URL Input -->
                    <div id="input-url-group" class="hidden">
                        <input type="url" id="item-image-url" placeholder="https://..." class="w-full bg-gray-50 border border-gray-100 rounded-2xl px-5 py-3.5 focus:ring-2 focus:ring-rose-200 outline-none transition">
                    </div>
                    
                    <input type="hidden" id="final-image-data">
                </div>

                <!-- Grid Harga & Ukuran -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="text-xs font-bold text-gray-400 uppercase tracking-wider ml-1">Harga (Rp)</label>
                        <input type="number" id="item-price" required class="w-full bg-gray-50 border border-gray-100 rounded-2xl px-5 py-3.5 focus:ring-2 focus:ring-rose-200 focus:bg-white outline-none transition text-gray-700 font-medium">
                    </div>
                    <div class="space-y-2">
                        <label class="text-xs font-bold text-gray-400 uppercase tracking-wider ml-1">Ukuran</label>
                        <input type="text" id="item-size" placeholder="Cth: 500gr" required class="w-full bg-gray-50 border border-gray-100 rounded-2xl px-5 py-3.5 focus:ring-2 focus:ring-rose-200 focus:bg-white outline-none transition text-gray-700 font-medium">
                    </div>
                </div>

                <!-- Label -->
                <div class="space-y-2">
                    <label class="text-xs font-bold text-gray-400 uppercase tracking-wider ml-1">Stiker Label</label>
                    <div class="relative">
                        <select id="item-badge" class="w-full bg-gray-50 border border-gray-100 rounded-2xl px-5 py-3.5 focus:ring-2 focus:ring-rose-200 focus:bg-white outline-none transition text-gray-700 appearance-none font-medium">
                            <option value="">Polos (Tanpa Stiker)</option>
                            <option value="Best Seller">üî• Best Seller (Paling Laris)</option>
                            <option value="New">‚ú® New Arrival (Menu Baru)</option>
                            <option value="Premium">üíé Premium Quality</option>
                            <option value="Limited">‚è≥ Limited Stock</option>
                        </select>
                        <div class="absolute right-5 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none">
                            <i class="fas fa-chevron-down text-xs"></i>
                        </div>
                    </div>
                </div>

                <!-- Deskripsi dengan AI -->
                <div class="space-y-2">
                    <div class="flex justify-between items-center">
                        <label class="text-xs font-bold text-gray-400 uppercase tracking-wider ml-1">Kata-kata Promosi</label>
                        <button type="button" onclick="generateAIDescription()" class="text-[10px] bg-indigo-50 text-indigo-600 px-2.5 py-1 rounded-lg font-bold hover:bg-indigo-100 transition flex items-center border border-indigo-100">
                            <i class="fas fa-magic mr-1"></i> Buat Otomatis
                        </button>
                    </div>
                    <div class="relative">
                        <textarea id="item-desc" rows="3" placeholder="Deskripsikan kelezatan kue ini..." required class="w-full bg-gray-50 border border-gray-100 rounded-2xl px-5 py-3.5 focus:ring-2 focus:ring-rose-200 focus:bg-white outline-none transition text-gray-600 leading-relaxed"></textarea>
                        
                        <!-- AI Loading Overlay -->
                        <div id="ai-loading" class="hidden absolute inset-0 bg-white/80 backdrop-blur-[2px] flex items-center justify-center rounded-2xl z-10 border border-indigo-100">
                            <div class="flex flex-col items-center text-indigo-500 text-xs font-bold">
                                <div class="w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center mb-2 animate-bounce">
                                    <i class="fas fa-robot"></i>
                                </div>
                                <span>Merangkai kata...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="pt-4 pb-4 flex gap-3">
                    <button type="button" onclick="closeModal()" class="flex-1 py-3.5 bg-gray-100 text-gray-600 rounded-2xl font-bold hover:bg-gray-200 active:scale-95 transition">Batal</button>
                    <button type="submit" id="btn-save" class="flex-[2] py-3.5 bg-rose-500 text-white rounded-2xl font-bold hover:bg-rose-600 shadow-lg shadow-rose-200 active:scale-95 transition flex items-center justify-center gap-2">
                        <span>Simpan Menu</span> <i class="fas fa-check"></i>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- 3. DELETE CONFIRMATION MODAL -->
    <div id="delete-modal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-gray-900/40 backdrop-blur-sm px-4">
        <div class="modal-content bg-white rounded-3xl shadow-2xl w-full max-w-xs p-6 text-center transform transition-all">
            <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-red-50 mb-5 text-red-400 text-2xl animate-pulse">
                <i class="fas fa-trash-alt"></i>
            </div>
            <h3 class="text-xl font-bold text-gray-800 mb-2 font-serif">Hapus Kue Ini?</h3>
            <p class="text-sm text-gray-400 mb-8 px-2">Yakin mau menghapus dari daftar menu?</p>
            <div class="flex gap-3">
                <button onclick="closeDeleteModal()" class="flex-1 py-3 bg-gray-100 text-gray-600 rounded-2xl font-bold hover:bg-gray-200 transition">Batal</button>
                <button onclick="confirmDelete()" class="flex-1 py-3 bg-red-500 text-white rounded-2xl font-bold hover:bg-red-600 shadow-lg shadow-red-200 transition">Hapus</button>
            </div>
        </div>
    </div>

    <!-- TOAST NOTIFICATION -->
    <div id="toast">Notifikasi</div>

    <!-- Firebase Scripts -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, setDoc, onSnapshot, doc, updateDoc, deleteDoc, writeBatch } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";

        // --- GLOBAL ERROR HANDLER FOR DEBUGGING ---
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            const container = document.getElementById('debug-console');
            if(container) {
                container.style.display = 'block';
                container.innerHTML += `<p style="color: #ff5555; border-bottom: 1px solid #333; padding-bottom: 2px; margin-bottom: 4px;">${msg} <span style="color: #888;">(Line: ${lineNo})</span></p>`;
            }
            return false;
        };

        // --- KONFIGURASI FIREBASE (WAJIB DIISI) ---
        let firebaseConfig;
        let appId = 'default-app-id';

        // Logika deteksi environment (Editor vs Production/GitHub)
        try {
            if (typeof __firebase_config !== 'undefined') {
                // Berjalan di dalam Editor Immersive (Preview)
                firebaseConfig = JSON.parse(__firebase_config);
                appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            } else {
                // Berjalan di GitHub / Hosting lain (Production)
                // Konfigurasi Project Anda: dapurraline-fe5b7
                firebaseConfig = {
                    apiKey: "AIzaSyD17rzkYiknKqrYKzy5OxzaGHJQ_rz4Kqs",
                    authDomain: "dapurraline-fe5b7.firebaseapp.com",
                    projectId: "dapurraline-fe5b7",
                    storageBucket: "dapurraline-fe5b7.firebasestorage.app",
                    messagingSenderId: "492929761942",
                    appId: "1:492929761942:web:7aab20a5b2340facdf38b7",
                    measurementId: "G-6HY0KNJLGV"
                };
                // Gunakan ID statis untuk production agar path database konsisten
                appId = 'production-v1'; 
            }
        } catch (e) {
            console.error("Config Error:", e);
            document.getElementById('config-error').classList.remove('hidden');
        }

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app); // Initialize Analytics
        const auth = getAuth(app);
        const db = getFirestore(app);
        const COLLECTION_NAME = "menu_items";
        const phoneNumber = "6285179895901"; 
        
        // --- API KEY UNTUK AI (Opsional untuk GitHub) ---
        const apiKey = ""; 

        let isAdmin = false;
        let deleteIdTarget = null;
        let unsubscribeSnapshot = null; 
        let currentItems = [];

        // 1. Setup Auth Listener
        onAuthStateChanged(auth, (user) => {
            if (user) {
                if (!unsubscribeSnapshot) {
                    setupDataListener();
                }
            } else {
                // Jika logout, bersihkan listener
                if (unsubscribeSnapshot) {
                    unsubscribeSnapshot();
                    unsubscribeSnapshot = null;
                }
            }
        });

        // 2. Trigger Login
        const initAuth = async () => {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Auth error:", error);
                const loadingElement = document.getElementById('loading');
                loadingElement.innerHTML = `
                    <div class="text-red-500 font-bold mb-2">Gagal Login ke Database</div>
                    <p class="text-xs text-gray-500 px-4">Pastikan "Anonymous Auth" sudah diaktifkan di Firebase Console.</p>
                    <p class="text-xs text-red-400 mt-2 font-mono">${error.message}</p>
                `;
                // Show debug console
                const dbg = document.getElementById('debug-console');
                dbg.style.display = 'block';
                dbg.innerHTML += `<p style="color: #ff5555;">Auth Failed: ${error.message}</p>`;
            }
        };

        initAuth();

        // 3. Data Logic
        function setupDataListener() {
            const q = collection(db, 'artifacts', appId, 'public', 'data', COLLECTION_NAME);
            
            unsubscribeSnapshot = onSnapshot(q, (snapshot) => {
                const items = [];
                snapshot.forEach((doc) => {
                    items.push({ id: doc.id, ...doc.data() });
                });

                currentItems = items;

                if (items.length === 0 && snapshot.metadata.hasPendingWrites === false) {
                    // Jika data kosong, coba isi data awal
                    seedDefaultData().catch(err => {
                        console.error("Gagal mengisi data awal:", err);
                        // Tampilkan pesan error jika gagal seed (biasanya karena Rules permission)
                        const loadingElement = document.getElementById('loading');
                        if (err.code === 'permission-denied') {
                             loadingElement.innerHTML = `
                                <div class="text-red-500 font-bold mb-2">Akses Ditolak</div>
                                <p class="text-xs text-gray-500 px-4">Pastikan "Firestore Rules" di Firebase Console sudah diatur ke "allow read, write: if true;".</p>
                            `;
                        }
                    });
                } else {
                    renderMenu(items);
                    document.getElementById('loading').style.display = 'none';
                }
            }, (error) => {
                console.error("Error fetching data:", error);
                const loadingElement = document.getElementById('loading');
                
                let errorMsg = "Gagal memuat data.";
                let errorTip = "Cek koneksi internet Anda.";

                if (error.code === 'permission-denied') {
                    errorMsg = "Izin Akses Ditolak";
                    errorTip = "Cek Firestore Rules di Firebase Console.";
                } else if (error.code === 'unavailable') {
                    errorMsg = "Layanan Tidak Tersedia";
                    errorTip = "Cek koneksi internet atau status Firebase.";
                }

                loadingElement.innerHTML = `
                    <div class="text-red-500 font-bold mb-2">${errorMsg}</div>
                    <p class="text-xs text-gray-500 px-4">${errorTip}</p>
                    <p class="text-[10px] text-red-300 mt-2 font-mono">${error.code}</p>
                `;
                
                // Show debug console
                const dbg = document.getElementById('debug-console');
                dbg.style.display = 'block';
                dbg.innerHTML += `<p style="color: #ff5555;">Snapshot Error: ${error.code} - ${error.message}</p>`;
            });
        }

        async function seedDefaultData() {
            const defaults = [
                {
                    id: "nastar-premium",
                    name: "Nastar Keju Premium",
                    price: 135000,
                    size: "500gr",
                    image: "",
                    desc: "Nastar klasik dengan selai nanas madu buatan sendiri, dibalut adonan butter wisman yang lumer di mulut. Favorit keluarga setiap lebaran.",
                    badge: "Best Seller"
                },
                {
                    id: "putri-salju-mede",
                    name: "Putri Salju Mede",
                    price: 125000,
                    size: "500gr",
                    image: "",
                    desc: "Sensasi dingin gula halus membalut renyahnya kacang mede sangrai. Manisnya pas, teksturnya ngeprul banget, Bun!",
                    badge: "Premium"
                },
                 {
                    id: "kastengel-keju",
                    name: "Kastengel Keju Edam",
                    price: 145000,
                    size: "500gr",
                    image: "",
                    desc: "Gurihnya keju edam asli berpadu dengan butter berkualitas. Teksturnya renyah dan 'ngeju' banget sampai gigitan terakhir.",
                    badge: "Limited"
                }
            ];

            const colRef = collection(db, 'artifacts', appId, 'public', 'data', COLLECTION_NAME);
            
            try {
                // Gunakan Promise.all untuk mempercepat dan setDoc agar idempoten
                const promises = defaults.map(item => {
                    const docRef = doc(colRef, item.id);
                    // Kita pisahkan ID agar tidak masuk ke field data (opsional, tapi lebih rapi)
                    const { id, ...data } = item;
                    return setDoc(docRef, data, { merge: true });
                });
                await Promise.all(promises);
                console.log("Data awal berhasil dibuat");
            } catch (e) {
                // Ignore jika sudah ada atau error minor saat seed
                console.error("Seed warning:", e);
                // Jika errornya permission denied, akan ditangkap oleh listener utama
                if(e.code === 'permission-denied') throw e;
            }
        }

        // 3. Render Logic
        function renderMenu(items) {
            const container = document.getElementById('menu-container');
            container.innerHTML = '';

            items.forEach(item => {
                const badgeHtml = item.badge 
                    ? `<div class="absolute top-4 right-4 bg-white/95 backdrop-blur-sm text-rose-500 text-[10px] font-bold px-3 py-1.5 rounded-full uppercase tracking-widest shadow-sm z-10 flex items-center gap-1 border border-rose-100"><i class="fas fa-star text-[9px]"></i> ${item.badge}</div>` 
                    : '';
                
                const itemSize = item.size || "500gr";
                
                // --- IMAGE HANDLING LOGIC (Web) ---
                // We use a container that will show either an IMG or a DIV with text
                let imageElement = '';
                const hasValidImage = item.image && !item.image.includes('images.unsplash.com');

                if (hasValidImage) {
                    imageElement = `
                        <img src="${item.image}" alt="${item.name}" 
                             class="w-full h-full object-cover transition duration-700 ease-in-out transform group-hover:scale-110"
                             loading="lazy"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="hidden w-full h-full bg-rose-50 flex items-center justify-center text-center p-4">
                            <span class="font-serif text-2xl text-rose-600 font-bold">${item.name}</span>
                        </div>
                    `;
                } else {
                    imageElement = `
                        <div class="w-full h-full bg-rose-50 flex items-center justify-center text-center p-4">
                            <span class="font-serif text-2xl text-rose-600 font-bold">${item.name}</span>
                        </div>
                    `;
                }

                // Admin buttons rendered conditionally based on state, but initially hidden if not admin
                const adminDisplayClass = isAdmin ? '' : 'hidden';
                const adminControls = `
                    <div class="admin-controls ${adminDisplayClass} absolute top-4 left-4 z-20 flex gap-2">
                        <button onclick="window.editItem('${item.id}')" class="bg-white/90 backdrop-blur-md text-amber-500 w-9 h-9 rounded-full shadow-sm hover:bg-white flex items-center justify-center transition active:scale-90 hover:text-amber-600 hover:shadow-md"><i class="fas fa-pen text-xs"></i></button>
                        <button onclick="window.askDelete('${item.id}')" class="bg-white/90 backdrop-blur-md text-red-400 w-9 h-9 rounded-full shadow-sm hover:bg-white flex items-center justify-center transition active:scale-90 hover:text-red-600 hover:shadow-md"><i class="fas fa-trash-alt text-xs"></i></button>
                    </div>
                `;

                const card = `
                <div class="glass-card rounded-[2rem] overflow-hidden hover:shadow-2xl hover:shadow-rose-100 transition-all duration-500 group flex flex-col h-full transform hover:-translate-y-1">
                    <div class="relative h-64 overflow-hidden p-3">
                        <div class="w-full h-full rounded-[1.5rem] overflow-hidden relative bg-rose-50">
                            ${imageElement}
                            <div class="absolute inset-0 bg-black/5 group-hover:bg-black/0 transition-colors pointer-events-none"></div>
                        </div>
                        ${badgeHtml}
                        ${adminControls}
                    </div>
                    
                    <div class="px-6 pb-6 pt-2 flex flex-col flex-grow">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="text-xl font-bold text-gray-800 leading-tight font-serif group-hover:text-rose-600 transition-colors">${item.name}</h3>
                        </div>
                        
                        <div class="flex items-center gap-3 mb-4">
                             <span class="text-lg font-bold text-rose-500">
                                Rp ${parseInt(item.price).toLocaleString('id-ID')}
                             </span>
                             <div class="h-1 w-1 bg-gray-300 rounded-full"></div>
                             <span class="text-xs text-gray-400 font-medium uppercase tracking-wide bg-gray-50 px-2 py-0.5 rounded-md">
                                ${itemSize}
                            </span>
                        </div>
                        
                        <p class="text-sm text-gray-500 mb-6 leading-relaxed flex-grow font-light border-t border-dashed border-gray-100 pt-4">${item.desc}</p>
                        
                        <button onclick="window.orderItem('${item.name}', ${item.price}, '${itemSize}')" class="w-full bg-gray-50 hover:bg-rose-500 hover:text-white text-gray-700 font-bold py-3.5 rounded-2xl transition-all duration-300 flex items-center justify-center gap-2 group-hover:shadow-lg group-hover:shadow-rose-200 mt-auto">
                            <span>Pesan Sekarang</span> <i class="fas fa-shopping-bag text-sm opacity-50 group-hover:opacity-100 transition-opacity"></i>
                        </button>
                    </div>
                </div>
                `;
                container.insertAdjacentHTML('beforeend', card);
            });
        }

        // 4. UI Helper Functions
        function showToast(message) {
            const toast = document.getElementById("toast");
            toast.innerText = message;
            toast.className = "show";
            setTimeout(function(){ toast.className = toast.className.replace("show", ""); }, 3000);
        }

        // 5. Admin Logic
        window.toggleAdminModal = function() {
            if (isAdmin) {
                showToast("Anda sudah login sebagai Admin.");
                // Optional: Scroll to top to see admin bar
                window.scrollTo({top: 0, behavior: 'smooth'});
            } else {
                document.getElementById('login-modal').classList.add('active');
                setTimeout(() => document.getElementById('admin-password').focus(), 100);
            }
        };

        window.closeLoginModal = function() {
            document.getElementById('login-modal').classList.remove('active');
            document.getElementById('admin-password').value = '';
        }

        window.handleLogin = function(e) {
            e.preventDefault();
            const pass = document.getElementById('admin-password').value;
            // Simple hardcoded password for demo purposes
            if (pass === "admin123") {
                isAdmin = true;
                updateAdminUI();
                closeLoginModal();
                showToast("Selamat Datang, Owner! üë©‚Äçüç≥");
                document.getElementById('admin-bar').classList.remove('hidden');
                document.getElementById('main-nav').classList.remove('top-0');
                document.getElementById('main-nav').classList.add('top-8');
            } else {
                showToast("Password Salah!");
                document.getElementById('admin-password').classList.add('border-red-500');
                setTimeout(()=>document.getElementById('admin-password').classList.remove('border-red-500'), 1000);
            }
        }

        window.logoutAdmin = function() {
            isAdmin = false;
            updateAdminUI();
            showToast("Berhasil Keluar");
            document.getElementById('admin-bar').classList.add('hidden');
            document.getElementById('main-nav').classList.add('top-0');
            document.getElementById('main-nav').classList.remove('top-8');
        };

        window.resetData = async function() {
            if(!confirm("Yakin ingin mereset semua data kue? Data lama akan dihapus.")) return;
            
            const batch = writeBatch(db);
            currentItems.forEach(item => {
                const ref = doc(db, 'artifacts', appId, 'public', 'data', COLLECTION_NAME, item.id);
                batch.delete(ref);
            });
            
            try {
                await batch.commit();
                showToast("Data berhasil direset. Refresh halaman...");
                setTimeout(() => location.reload(), 1500);
            } catch(e) {
                showToast("Gagal reset data");
            }
        }

        function updateAdminUI() {
            const fabAddBtn = document.getElementById('fab-add-btn');
            const navAddBtn = document.getElementById('nav-add-btn');
            
            // Toggle global buttons
            if (isAdmin) {
                fabAddBtn.classList.remove('hidden');
                navAddBtn.classList.remove('hidden');
            } else {
                fabAddBtn.classList.add('hidden');
                navAddBtn.classList.add('hidden');
            }

            // Toggle card buttons without full re-render
            const controls = document.querySelectorAll('.admin-controls');
            controls.forEach(el => {
                if (isAdmin) el.classList.remove('hidden');
                else el.classList.add('hidden');
            });
        }

        // 6. CRUD Modals & Logic
        window.openModal = function() {
            document.getElementById('item-modal').classList.add('active');
            document.getElementById('menu-form').reset();
            document.getElementById('item-id').value = '';
            document.getElementById('modal-title').innerText = "Menu Baru";
            
            // Set default value for new item
            document.getElementById('item-size').value = "500gr";

            // Reset image states
            document.getElementById('final-image-data').value = '';
            document.getElementById('image-preview-container').classList.add('hidden');
            window.toggleUploadMode('file');
            
            // Update tabs UI
            document.getElementById('tab-file').className = "flex-1 py-2 rounded-lg text-sm font-semibold text-rose-500 bg-white shadow-sm transition-all";
            document.getElementById('tab-url').className = "flex-1 py-2 rounded-lg text-sm font-medium text-gray-400 hover:text-gray-600 transition-all";
        }

        window.closeModal = function() {
            document.getElementById('item-modal').classList.remove('active');
        }

        window.editItem = function(id) {
            const item = currentItems.find(i => i.id === id);
            if(!item) return;

            document.getElementById('item-id').value = id;
            document.getElementById('item-name').value = item.name;
            document.getElementById('item-price').value = item.price;
            document.getElementById('item-size').value = item.size || "500gr";
            document.getElementById('item-desc').value = item.desc;
            document.getElementById('item-badge').value = item.badge || "";
            
            // Handle Image
            document.getElementById('final-image-data').value = item.image;
            document.getElementById('image-preview').src = item.image;
            document.getElementById('image-preview-container').classList.remove('hidden');

            // Determine if URL or Base64 (simple check)
            if(item.image.startsWith('http')) {
                 window.toggleUploadMode('url');
                 document.getElementById('item-image-url').value = item.image;
            } else {
                 window.toggleUploadMode('file');
            }

            document.getElementById('modal-title').innerText = "Edit Menu";
            document.getElementById('item-modal').classList.add('active');
        }

        // --- IMAGE HANDLING & COMPRESSION ---
        window.toggleUploadMode = function(mode) {
            const fileGroup = document.getElementById('input-file-group');
            const urlGroup = document.getElementById('input-url-group');
            const tabFile = document.getElementById('tab-file');
            const tabUrl = document.getElementById('tab-url');

            if(mode === 'file') {
                fileGroup.classList.remove('hidden');
                urlGroup.classList.add('hidden');
                tabFile.className = "flex-1 py-2 rounded-lg text-sm font-semibold text-rose-500 bg-white shadow-sm transition-all";
                tabUrl.className = "flex-1 py-2 rounded-lg text-sm font-medium text-gray-400 hover:text-gray-600 transition-all";
            } else {
                fileGroup.classList.add('hidden');
                urlGroup.classList.remove('hidden');
                tabUrl.className = "flex-1 py-2 rounded-lg text-sm font-semibold text-rose-500 bg-white shadow-sm transition-all";
                tabFile.className = "flex-1 py-2 rounded-lg text-sm font-medium text-gray-400 hover:text-gray-600 transition-all";
            }
        }

        window.handleFileSelect = function(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                
                // Show loading placeholder
                document.getElementById('image-preview').src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MCIgaGVpZ2h0PSI1MCIgdmlld0JveD0iMCAwIDUwIDUwIj48Y2lyY2xlIGN4PSIyNSIgY3k9IjI1IiByPSIyMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZmZjMGMiIHN0cm9rZS13aWR0aD0iNCIvPjwvc3ZnPg=='; 
                document.getElementById('image-preview-container').classList.remove('hidden');

                const reader = new FileReader();

                reader.onload = function(e) {
                    const img = new Image();
                    img.src = e.target.result;
                    
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        // Aggressive compression for Firestore
                        const MAX_WIDTH = 600; 
                        const MAX_HEIGHT = 600;
                        let width = img.width;
                        let height = img.height;

                        if (width > height) {
                            if (width > MAX_WIDTH) {
                                height *= MAX_WIDTH / width;
                                width = MAX_WIDTH;
                            }
                        } else {
                            if (height > MAX_HEIGHT) {
                                width *= MAX_HEIGHT / height;
                                height = MAX_HEIGHT;
                            }
                        }

                        canvas.width = width;
                        canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);

                        // Output as JPEG with 0.5 quality to ensure small size
                        const dataUrl = canvas.toDataURL('image/jpeg', 0.5);
                        
                        document.getElementById('final-image-data').value = dataUrl;
                        document.getElementById('image-preview').src = dataUrl;
                    }
                }
                reader.readAsDataURL(file);
            }
        }
        
        document.getElementById('item-image-url').addEventListener('change', function(e) {
             const url = e.target.value;
             if(url) {
                 document.getElementById('final-image-data').value = url;
                 document.getElementById('image-preview').src = url;
                 document.getElementById('image-preview-container').classList.remove('hidden');
             }
        });

        // --- AI GENERATION FEATURE ---
        window.generateAIDescription = async function() {
            const name = document.getElementById('item-name').value;
            if (!name) {
                showToast("Isi nama kue dulu ya!");
                document.getElementById('item-name').focus();
                return;
            }
            
            if (!apiKey) {
                // Warning if API key is missing (for local dev)
                console.warn("API Key not set");
            }

            document.getElementById('ai-loading').classList.remove('hidden');
            
            try {
                // Context-aware prompt specifically for "Kue Lebaran"
                const prompt = `Buatkan deskripsi penjualan kue lebaran yang sangat menggugah selera, manis, emosional dan persuasif untuk target pasar ibu-ibu. Fokus pada rasa, tekstur, dan suasana lebaran. Nama kue: "${name}". Maksimal 2 kalimat pendek. Gunakan kata emosional seperti 'kesukaan keluarga', 'resep warisan', 'lumer', 'wajib ada'.`;
                
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: prompt }]
                        }]
                    })
                });

                if (!response.ok) throw new Error("Network response was not ok");

                const data = await response.json();
                
                if (data.candidates && data.candidates[0].content) {
                    const aiText = data.candidates[0].content.parts[0].text;
                    document.getElementById('item-desc').value = aiText.trim();
                    showToast("Deskripsi cantik siap! ‚ú®");
                } else {
                    throw new Error("Gagal generate text");
                }
            } catch (error) {
                console.error("AI Error:", error);
                // Fallback text if AI fails
                const fallbacks = [
                    `Kue ${name} yang super lembut dan lumer di mulut, dijamin jadi rebutan saat lebaran nanti.`,
                    `Sajikan kehangatan lewat ${name} premium ini, rasanya bikin kangen suasana hari raya.`,
                    `Resep klasik ${name} yang otentik, menggunakan bahan premium untuk kualitas rasa terbaik.`
                ];
                document.getElementById('item-desc').value = fallbacks[Math.floor(Math.random() * fallbacks.length)];
                showToast("Menggunakan deskripsi template (AI Busy).");
            } finally {
                document.getElementById('ai-loading').classList.add('hidden');
            }
        }


        // --- DELETE & SUBMIT ---
        window.askDelete = function(id) {
            deleteIdTarget = id;
            document.getElementById('delete-modal').classList.add('active');
        }

        window.closeDeleteModal = function() {
            document.getElementById('delete-modal').classList.remove('active');
            deleteIdTarget = null;
        }

        window.confirmDelete = async function() {
            if (!deleteIdTarget) return;
            try {
                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', COLLECTION_NAME, deleteIdTarget));
                showToast("Menu berhasil dihapus");
            } catch (e) {
                showToast("Gagal menghapus: " + e.message);
            }
            closeDeleteModal();
        }

        window.handleFormSubmit = async function(e) {
            e.preventDefault();
            
            let finalImage = document.getElementById('final-image-data').value;
            const btnSave = document.getElementById('btn-save');
            const originalBtnContent = btnSave.innerHTML;
            
            // Check visibility of URL input to determine source priority
            if(!document.getElementById('input-url-group').classList.contains('hidden')) {
                 const urlVal = document.getElementById('item-image-url').value;
                 if(urlVal) finalImage = urlVal;
            }

            if(!finalImage) {
                // If no image is selected, we can allow saving and it will render the fallback text
                // However, to keep it clean, let's treat empty image as intent to use fallback
                finalImage = ""; // Explicitly empty
            }
            
            // Firestore limit check (approx 1MB limit, keeping safe buffer)
            if(finalImage.length > 900000) { 
                 showToast("Foto terlalu besar. Coba kompres atau pilih foto lain.");
                 return;
            }

            btnSave.disabled = true;
            btnSave.innerHTML = '<div class="loader"></div>';
            
            const id = document.getElementById('item-id').value;
            const data = {
                name: document.getElementById('item-name').value,
                price: Number(document.getElementById('item-price').value),
                size: document.getElementById('item-size').value,
                image: finalImage,
                desc: document.getElementById('item-desc').value,
                badge: document.getElementById('item-badge').value
            };

            const colRef = collection(db, 'artifacts', appId, 'public', 'data', COLLECTION_NAME);

            try {
                if (id) {
                    await updateDoc(doc(colRef, id), data);
                    showToast("Menu berhasil diperbarui ‚ú®");
                } else {
                    await addDoc(colRef, data);
                    showToast("Menu baru ditambahkan üéâ");
                }
                closeModal();
            } catch (error) {
                console.error("Error saving:", error);
                if(error.message.includes("exceeds")) {
                     showToast("Ukuran data foto terlalu besar untuk disimpan.");
                } else {
                     showToast("Gagal menyimpan data.");
                }
            } finally {
                 btnSave.disabled = false;
                 btnSave.innerHTML = originalBtnContent;
            }
        }

        // User functions
        window.orderItem = function(itemName, price, size) {
            const sizeText = size ? `(${size})` : '';
            // Polite message for mothers/women
            const message = `Assalamu'alaikum Kak Admin, saya mau pesan kue *${itemName} ${sizeText}* seharga Rp ${price.toLocaleString('id-ID')}. Apakah masih bisa ikut PO? Terima kasih üíï`;
            const url = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
            window.open(url, '_blank');
        }

        window.contactWA = function() {
            const message = "Assalamu'alaikum, boleh minta info katalog lengkap kue lebarannya? Terima kasih üíï";
            const url = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
            window.open(url, '_blank');
        }

    </script>
</body>
</html>
